{% extends 'admin/base.html' %}
{% block page_title %}Users & Scores{% endblock %}

{% block content %}
<div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
  <div class="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
    <h2 class="font-semibold text-slate-700">All Participants ({{ users|length }})</h2>
    <div class="text-xs text-slate-400">Sorted by total points</div>
  </div>
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead class="bg-slate-50">
        <tr>
          <th class="text-left px-4 py-3 text-slate-500 font-medium">#</th>
          <th class="text-left px-4 py-3 text-slate-500 font-medium">Name</th>
          <th class="text-left px-4 py-3 text-slate-500 font-medium">Phone</th>
          <th class="text-left px-4 py-3 text-slate-500 font-medium">Joined</th>
          <th class="text-center px-4 py-3 text-slate-500 font-medium">Sessions</th>
          <th class="text-center px-4 py-3 text-slate-500 font-medium">Answered</th>
          <th class="text-center px-4 py-3 text-slate-500 font-medium">Correct</th>
          <th class="text-center px-4 py-3 text-slate-500 font-medium">Points</th>
          <th class="px-4 py-3"></th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        {% set acc = ((u.correct_count / u.total_answered) * 100)|int if u.total_answered and u.total_answered > 0 else 0 %}
        <tr class="border-t border-slate-50 hover:bg-slate-50 transition">
          <td class="px-4 py-3 text-slate-400 font-mono text-xs">
            {% if loop.index == 1 %}ðŸ¥‡{% elif loop.index == 2 %}ðŸ¥ˆ{% elif loop.index == 3 %}ðŸ¥‰{% else %}{{ loop.index }}{% endif %}
          </td>
          <td class="px-4 py-3 font-medium text-slate-800">{{ u.name }}</td>
          <td class="px-4 py-3 text-slate-500 font-mono text-xs">{{ u.phone }}</td>
          <td class="px-4 py-3 text-slate-400 text-xs">{{ u.created_at[:10] }}</td>
          <td class="px-4 py-3 text-center text-slate-600">{{ u.sessions_taken or 0 }}</td>
          <td class="px-4 py-3 text-center text-slate-500">{{ u.total_answered or 0 }}</td>
          <td class="px-4 py-3 text-center">
            <span class="text-green-600 font-semibold">{{ u.correct_count or 0 }}</span>
            {% if u.total_answered and u.total_answered > 0 %}
            <span class="text-slate-300 text-xs ml-1">({{ acc }}%)</span>
            {% endif %}
          </td>
          <td class="px-4 py-3 text-center">
            <span class="bg-amber-100 text-amber-800 font-bold px-2.5 py-0.5 rounded-full text-xs">
              {{ u.total_points or 0 }}
            </span>
          </td>
          <td class="px-4 py-3">
            <a href="{{ url_for('admin_user_detail', user_id=u.id) }}"
               class="text-blue-500 hover:text-blue-700 text-xs font-medium whitespace-nowrap">
              View â†’
            </a>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="9" class="px-4 py-10 text-center text-slate-400">No users yet</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
